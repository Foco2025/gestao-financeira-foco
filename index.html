<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o Pessoal - Foco Consultoria 2026</title>
    <!-- Bibliotecas de Estilo e Gr√°ficos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Bibliotecas de PDF e Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <!-- React e Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root { --orange: #FF6600; --black: #000000; --gray: #121212; }
        body { background-color: var(--black); color: white; font-family: 'Inter', sans-serif; margin: 0; }
        .sidebar { background-color: var(--gray); border-right: 1px solid #333; min-height: 100vh; }
        .card { background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 20px; }
        .btn-orange { background-color: var(--orange); color: white; font-weight: bold; border-radius: 8px; padding: 10px 15px; cursor: pointer; }
        .active-menu { border-left: 4px solid var(--orange); background: #1e1e1e; color: var(--orange) !important; }
        input, select, textarea { background: #222 !important; color: white !important; border: 1px solid #444 !important; padding: 8px !important; border-radius: 6px !important; width: 100%; margin-top: 4px; }
        .dropzone { border: 2px dashed #444; border-radius: 8px; padding: 15px; text-align: center; cursor: pointer; font-size: 11px; display: block; color: var(--orange); font-weight: bold; }
        .dropzone:hover { border-color: var(--orange); background: #1e1e1e; }
        .chart-container { position: relative; height: 220px; width: 100%; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Configura√ß√£o do PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        function App() {
            const getSaved = (k, d) => { try { const s = localStorage.getItem(k); return s ? JSON.parse(s) : d; } catch(e) { return d; } };

            const [view, setView] = useState('dashboard');
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [transactions, setTransactions] = useState(() => getSaved('foco_tx', []));
            const [banks, setBanks] = useState(() => getSaved('foco_bnk', []));
            const [cards, setCards] = useState(() => getSaved('foco_crd', []));
            const [profile, setProfile] = useState(() => getSaved('foco_prf', { name: 'Ricardo', photo: 'https://via.placeholder.com/100' }));
            
            const [market, setMarket] = useState({ usd: 5.15, btc: 410000 });
            const barChartRef = useRef(null);

            useEffect(() => {
                localStorage.setItem('foco_tx', JSON.stringify(transactions));
                localStorage.setItem('foco_bnk', JSON.stringify(banks));
                localStorage.setItem('foco_crd', JSON.stringify(cards));
                localStorage.setItem('foco_prf', JSON.stringify(profile));
                if(view === 'dashboard') renderCharts();
            }, [transactions, view, cards, banks]);

            // --- L√ìGICA DE LEITURA REAL DO PDF ---
            const handlePdfUpload = async (e, cardId) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async function() {
                    const typedarray = new Uint8Array(this.result);
                    const pdf = await pdfjsLib.getDocument(typedarray).promise;
                    let fullText = "";

                    // L√™ as primeiras 2 p√°ginas (onde costumam estar os totais)
                    for (let i = 1; i <= Math.min(pdf.numPages, 2); i++) {
                        const page = await pdf.getPage(i);
                        const content = await page.getTextContent();
                        fullText += content.items.map(item => item.str).join(" ");
                    }

                    // Regex para capturar valor e data no formato do Banco Inter
                    // Busca "Total da sua fatura R$ 1.524,74" ou similares
                    const valorMatch = fullText.match(/Total da sua fatura\s*R\$\s*([\d.,]+)/i) || fullText.match(/Valor Total\s*R\$\s*([\d.,]+)/i);
                    const dataMatch = fullText.match(/Vencimento\s*(\d{2}\/\d{2}\/\d{4})/i) || fullText.match(/Data de Vencimento\s*(\d{2}\/\d{2}\/\d{4})/i);

                    if (valorMatch && dataMatch) {
                        const valorLimpo = parseFloat(valorMatch[1].replace(/\./g, '').replace(',', '.'));
                        const dataVenc = dataMatch[1].split('/').reverse().join('-'); // Converte para YYYY-MM-DD

                        // 1. Adiciona a despesa no extrato
                        const novoLancamento = {
                            id: Date.now(),
                            desc: `Fatura Cart√£o: ${file.name}`,
                            value: valorLimpo,
                            type: 'Despesa',
                            date: dataVenc,
                            bank: 'Cart√£o de Cr√©dito'
                        };
                        setTransactions(prev => [novoLancamento, ...prev]);

                        // 2. Atualiza o uso do cart√£o espec√≠fico
                        if(cardId) {
                            setCards(prev => prev.map(c => c.id === cardId ? {...c, used: valorLimpo} : c));
                        }

                        alert(`Leitura Conclu√≠da!\nValor: R$ ${valorLimpo.toLocaleString('pt-BR')}\nVencimento: ${dataMatch[1]}`);
                    } else {
                        alert("N√£o conseguimos ler os dados automaticamente. Verifique se o PDF √© uma fatura original.");
                    }
                };
                reader.readAsArrayBuffer(file);
            };

            const renderCharts = () => {
                setTimeout(() => {
                    const ctx = document.getElementById('barChart');
                    if(!ctx) return;
                    if(barChartRef.current) barChartRef.current.destroy();

                    const tin = transactions.filter(t => t.type === 'Receita').reduce((a,b) => a + parseFloat(b.value), 0);
                    const tout = transactions.filter(t => t.type === 'Despesa').reduce((a,b) => a + parseFloat(b.value), 0);

                    barChartRef.current = new Chart(ctx, {
                        type: 'bar',
                        data: { labels: ['Receitas', 'Despesas'], datasets: [{ data: [tin, tout], backgroundColor: ['#22c55e', '#ef4444'] }] },
                        options: { maintainAspectRatio: false }
                    });
                }, 200);
            };

            const totals = transactions.reduce((acc, t) => {
                const v = parseFloat(t.value || 0);
                t.type === 'Receita' ? acc.in += v : acc.out += v;
                return acc;
            }, { in: 0, out: 0 });

            const SidebarBtn = ({icon, label, id}) => (
                <button onClick={()=>setView(id)} className={`w-full flex items-center gap-4 px-8 py-4 text-[11px] font-bold transition-all uppercase ${view === id ? 'active-menu' : 'text-gray-500 hover:text-white hover:bg-gray-800'}`}>
                    <span className="text-lg">{icon}</span> {label}
                </button>
            );

            return (
                <div className="flex flex-col md:flex-row min-h-screen">
                    {/* SIDEBAR */}
                    <aside className={`sidebar w-72 flex flex-col no-print ${sidebarOpen ? 'block' : 'hidden md:block'}`}>
                        <div className="p-8 text-center border-b border-gray-800">
                            <img src={profile.photo} className="w-16 h-16 rounded-full border-2 border-orange-500 mx-auto mb-3 object-cover" />
                            <h2 className="text-orange-500 font-black italic uppercase tracking-tighter">Foco Consultoria</h2>
                            <p className="text-[10px] text-gray-500">Ol√°, {profile.name}</p>
                        </div>
                        <nav className="flex-1 mt-4">
                            <SidebarBtn icon="üìä" label="DASHBOARD" id="dashboard" />
                            <SidebarBtn icon="üìÅ" label="CATEGORIAS & BANCOS" id="cadastros" />
                            <SidebarBtn icon="üí∏" label="LAN√áAMENTOS" id="lancamentos" />
                            <SidebarBtn icon="üí≥" label="CART√ïES DE CR√âDITO" id="cartoes" />
                            <SidebarBtn icon="üìà" label="FLUXO DE CAIXA" id="timeline" />
                            <SidebarBtn icon="üèõÔ∏è" label="MERCADO 2026" id="mercado" />
                            <SidebarBtn icon="üìë" label="RELAT√ìRIOS" id="relatorios" />
                        </nav>
                    </aside>

                    {/* CONTE√öDO */}
                    <main className="flex-1 p-6 md:p-10 overflow-x-hidden">
                        <header className="flex justify-between items-center mb-8 border-b border-gray-800 pb-4 no-print font-black">
                            <h1 className="text-xl text-orange-500 uppercase italic">{view}</h1>
                            <button onClick={()=>setSidebarOpen(!sidebarOpen)} className="md:hidden text-orange-500">MENU</button>
                        </header>

                        {/* DASHBOARD */}
                        {view === 'dashboard' && (
                            <div className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 font-bold">
                                    <div className="card border-l-4 border-green-500"><p className="text-[10px] text-gray-500 uppercase">Receitas</p><p className="text-2xl text-green-500">R$ {totals.in.toLocaleString('pt-BR')}</p></div>
                                    <div className="card border-l-4 border-red-500"><p className="text-[10px] text-gray-500 uppercase">Despesas</p><p className="text-2xl text-red-500">R$ {totals.out.toLocaleString('pt-BR')}</p></div>
                                    <div className="card border-l-4 border-orange-500"><p className="text-[10px] text-gray-500 uppercase">Saldo</p><p className="text-2xl">R$ {(totals.in - totals.out).toLocaleString('pt-BR')}</p></div>
                                </div>
                                <div className="card">
                                    <h3 className="text-xs mb-4 uppercase">Resumo de Caixa</h3>
                                    <div className="chart-container"><canvas id="barChart"></canvas></div>
                                </div>
                            </div>
                        )}

                        {/* CADASTROS BANCO */}
                        {view === 'cadastros' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="card">
                                    <h3 className="text-orange-500 font-bold mb-4 uppercase italic">Novo Banco</h3>
                                    <form className="space-y-4" onSubmit={(e)=>{
                                        e.preventDefault();
                                        const fd = new FormData(e.target);
                                        setBanks([...banks, {id: Date.now(), name: fd.get('n'), balance: fd.get('s')}]);
                                        e.target.reset();
                                    }}>
                                        <input name="n" placeholder="Nome do Banco" required />
                                        <input name="s" type="number" step="0.01" placeholder="Saldo Inicial R$" required />
                                        <button className="btn-orange w-full">CADASTRAR</button>
                                    </form>
                                    <div className="mt-4 space-y-2">
                                        {banks.map(b => (
                                            <div key={b.id} className="bg-gray-800 p-2 rounded text-[10px] flex justify-between border-l-2 border-orange-500 uppercase">
                                                <span>{b.name} | S: R$ {b.balance}</span>
                                                <button onClick={()=>setBanks(banks.filter(x=>x.id!==b.id))} className="text-red-500">Excluir</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="card">
                                    <h3 className="text-orange-500 font-bold mb-4 uppercase italic">Categorias</h3>
                                    <div className="flex gap-2 mb-4"><input id="catIn" placeholder="Nova..." /><button className="btn-orange" onClick={()=>setCategories([...categories, document.getElementById('catIn').value])}>+</button></div>
                                    <div className="flex flex-wrap gap-2">{categories.map(c => <span key={c} className="bg-gray-800 px-3 py-1 rounded text-[10px] border border-gray-700 uppercase font-bold">{c}</span>)}</div>
                                </div>
                            </div>
                        )}

                        {/* LAN√áAMENTOS */}
                        {view === 'lancamentos' && (
                            <div className="space-y-6">
                                <div className="card border-orange-500/50">
                                    <h3 className="text-orange-500 font-bold mb-4 italic uppercase">Lan√ßamento Di√°rio</h3>
                                    <form className="grid grid-cols-1 md:grid-cols-4 gap-4" onSubmit={(e)=>{
                                        e.preventDefault();
                                        const fd = new FormData(e.target);
                                        const t = {id: Date.now(), desc: fd.get('d'), value: fd.get('v'), type: fd.get('t'), date: fd.get('dt'), bank: fd.get('b')};
                                        setTransactions([t, ...transactions]); e.target.reset();
                                    }}>
                                        <input name="d" placeholder="Descri√ß√£o" required className="md:col-span-2" />
                                        <input name="v" type="number" step="0.01" placeholder="Valor R$" required />
                                        <input name="dt" type="date" required />
                                        <select name="t"><option>Despesa</option><option>Receita</option></select>
                                        <select name="b"><option value="">Conta Vinculada</option>{banks.map(b=><option key={b.id} value={b.name}>{b.name}</option>)}</select>
                                        <button className="btn-orange md:col-span-2 uppercase">Salvar Movimenta√ß√£o</button>
                                    </form>
                                </div>
                                <div className="card overflow-x-auto">
                                    <table className="w-full text-left text-xs uppercase font-bold">
                                        <thead><tr className="text-orange-500 border-b border-gray-800">
                                            <th className="p-3">Data</th><th className="p-3">Descri√ß√£o</th><th className="p-3">Conta</th><th className="p-3 text-right">Valor</th><th className="p-3 text-center">A√ß√µes</th>
                                        </tr></thead>
                                        <tbody>
                                            {transactions.map(t => (
                                                <tr key={t.id} className="border-b border-gray-900">
                                                    <td className="p-3">{t.date}</td><td className="p-3">{t.desc}</td><td className="p-3 italic text-gray-500">{t.bank}</td>
                                                    <td className={`p-3 text-right ${t.type==='Receita'?'text-green-500':'text-red-500'}`}>R$ {parseFloat(t.value).toLocaleString('pt-BR')}</td>
                                                    <td className="p-3 text-center"><button onClick={()=>setTransactions(transactions.filter(x=>x.id!==t.id))}>üóëÔ∏è</button></td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* CART√ïES DE CR√âDITO (ATUALIZADO COM VENCIMENTO E LEITURA REAL) */}
                        {view === 'cartoes' && (
                            <div className="space-y-6">
                                <div className="card">
                                    <h3 className="text-orange-500 font-bold mb-4 uppercase italic tracking-widest">Novo Cart√£o</h3>
                                    <form className="grid grid-cols-1 md:grid-cols-4 gap-4" onSubmit={(e)=>{
                                        e.preventDefault();
                                        const fd = new FormData(e.target);
                                        const c = {id: Date.now(), name: fd.get('n'), limit: fd.get('l'), used: 0, fech: fd.get('f'), venc: fd.get('v')};
                                        setCards([...cards, c]); e.target.reset();
                                    }}>
                                        <input name="n" placeholder="Nome (Ex: Inter Ricardo)" required />
                                        <input name="l" type="number" placeholder="Limite Total R$" required />
                                        <input name="f" type="number" placeholder="Dia Fechamento" required />
                                        <input name="v" type="number" placeholder="Dia Vencimento" required />
                                        <button className="btn-orange md:col-span-4 uppercase">Salvar Cart√£o</button>
                                    </form>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {cards.map(c => (
                                        <div key={c.id} className="card border-l-4 border-orange-500 font-bold">
                                            <div className="flex justify-between mb-4 uppercase italic">
                                                <span>{c.name}</span>
                                                <button onClick={()=>setCards(cards.filter(x=>x.id!==c.id))} className="text-red-500 text-xs">Excluir</button>
                                            </div>
                                            <div className="w-full bg-gray-800 h-2 rounded-full mb-3 overflow-hidden">
                                                <div className="bg-orange-500 h-full" style={{width: `${Math.min((c.used/c.limit)*100, 100)}%`}}></div>
                                            </div>
                                            <div className="flex justify-between text-[10px] text-gray-500 uppercase mb-4 font-black">
                                                <span>Limite: R$ {parseFloat(c.limit).toLocaleString('pt-BR')}</span>
                                                <span>Fatura: R$ {parseFloat(c.used).toLocaleString('pt-BR')}</span>
                                            </div>
                                            <p className="text-[9px] text-orange-500 mb-4 italic uppercase">Fechamento: Dia {c.fech} | Vencimento: Dia {c.venc}</p>
                                            <label className="dropzone uppercase tracking-tighter">
                                                üì§ UPLOAD FATURA INTER (PDF)
                                                <input type="file" className="hidden" accept=".pdf" onChange={(e)=>handlePdfUpload(e, c.id)} />
                                            </label>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* TIMELINE */}
                        {view === 'timeline' && (
                            <div className="card">
                                <h3 className="text-orange-500 font-bold italic uppercase mb-8 underline underline-offset-8">Linha do Tempo de Gastos</h3>
                                <div className="relative border-l-2 border-orange-500 ml-4 space-y-8 uppercase text-xs">
                                    {transactions.sort((a,b)=>new Date(b.date)-new Date(a.date)).map(t => (
                                        <div key={t.id} className="relative pl-8">
                                            <div className="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-black border-2 border-orange-500"></div>
                                            <div className="bg-gray-900 p-4 rounded-lg flex justify-between border border-gray-800">
                                                <div><p className="text-[10px] text-gray-500">{t.date}</p><p className="font-black">{t.desc}</p></div>
                                                <p className={`font-black ${t.type==='Receita'?'text-green-500':'text-red-500'}`}>R$ {parseFloat(t.value).toLocaleString('pt-BR')}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* MERCADO FINANCEIRO */}
                        {view === 'mercado' && (
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center font-black uppercase text-[10px]">
                                <div className="card"><p className="text-gray-500 mb-1">D√≥lar</p><p className="text-xl">R$ 5,12</p></div>
                                <div className="card"><p className="text-gray-500 mb-1">Sal√°rio M√≠nimo</p><p className="text-xl text-orange-500">R$ 1.571,00</p></div>
                                <div className="card"><p className="text-gray-500 mb-1">SELIC</p><p className="text-xl">10.50%</p></div>
                                <div className="card"><p className="text-gray-500 mb-1">IPCA</p><p className="text-xl">3.80%</p></div>
                                <div className="card md:col-span-4 italic text-gray-600 border-dashed">Fonte: Proje√ß√µes Oficiais Jan/2026 - Mercado Financeiro</div>
                            </div>
                        )}

                        {/* RELAT√ìRIOS */}
                        {view === 'relatorios' && (
                            <div className="card border-orange-500 bg-orange-950/10 text-center py-10 uppercase font-black italic">
                                <h3 className="text-xl mb-10 text-orange-500 tracking-widest underline underline-offset-4">Centro de Exporta√ß√£o de Dados</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <button onClick={()=>exportData('pdf')} className="bg-red-900 p-4 rounded-lg flex items-center justify-center gap-2 hover:bg-red-700">üìÑ PDF</button>
                                    <button onClick={()=>exportData('xls')} className="bg-green-900 p-4 rounded-lg flex items-center justify-center gap-2 hover:bg-green-800">üìä EXCEL</button>
                                </div>
                                <button onClick={()=>window.print()} className="w-full btn-orange mt-6 py-4 text-lg">üñ®Ô∏è IMPRIMIR RELAT√ìRIO COMPLETO</button>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        function exportData(type) {
            alert('Exportando para ' + type.toUpperCase());
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
